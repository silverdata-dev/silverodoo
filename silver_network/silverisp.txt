
# Documentaci贸n del M贸dulo `silver_isp` para Odoo

**Versi贸n:** 1.0
**Fecha:** 2025-09-02

Este documento detalla la arquitectura, funcionalidad y estrategia del m贸dulo `silver_isp`, dise帽ado para gestionar operaciones de un Proveedor de Servicios de Internet (ISP) dentro del ecosistema Odoo.

---

##  Documentaci贸n Estrat茅gica / para Gerencia

### Visi贸n General del Proyecto

El proyecto `silver_isp` busca integrar la gesti贸n de la infraestructura de red, los activos f铆sicos, los clientes y los servicios de un ISP directamente en Odoo. La visi贸n es crear una plataforma unificada que centralice la informaci贸n y automatice los procesos clave, desde el despliegue de equipos hasta la gesti贸n de contratos y servicios de cliente.

### Objetivos del Sistema

*   **Centralizar el Inventario de Red:** Mantener un registro 煤nico y actualizado de todos los activos de red, como OLTs, ONUs, APs, postes, cajas de empalme, cables y splitters.
*   **Automatizar el Aprovisionamiento:** Facilitar la configuraci贸n y activaci贸n de servicios para nuevos clientes, integr谩ndose con equipos de red como routers y servidores RADIUS.
*   **Mejorar la Visibilidad de la Red:** Ofrecer herramientas de visualizaci贸n y mapeo de la infraestructura para facilitar la planificaci贸n, el mantenimiento y la resoluci贸n de problemas.
*   **Gestionar el Ciclo de Vida del Cliente:** Controlar desde el contrato inicial hasta la gesti贸n de servicios, desconexiones y cambios de plan.

### Problemas Actuales que se Buscan Resolver

*   Falta de un inventario centralizado y fiable de los equipos de red.
*   Procesos manuales y propensos a errores para el aprovisionamiento de nuevos clientes.
*   Dificultad para diagnosticar problemas de red por falta de visibilidad de la topolog铆a.
*   Informaci贸n de clientes y contratos dispersa en m煤ltiples sistemas.

### Beneficios Esperados

*   Reducci贸n del tiempo de aprovisionamiento de servicios.
*   Mejora en la precisi贸n del inventario de activos de red.
*   Optimizaci贸n de las operaciones de campo (instalaci贸n y mantenimiento).
*   Visi贸n 360掳 del cliente, desde su contrato hasta su configuraci贸n t茅cnica.
*   Automatizaci贸n de reportes operativos y de gesti贸n.

### Alcance Funcional

#### M贸dulos de Odoo a Implementar
Basado en las dependencias y la naturaleza del m贸dulo, se infiere la interacci贸n con los siguientes m贸dulos est谩ndar de Odoo:
*   **Inventario:** Para la gesti贸n de activos f铆sicos (OLTs, routers, cables).
*   **Ventas/Contabilidad:** Para la gesti贸n de contratos de clientes (`isp_contract.py`).
*   **Contactos:** Como base para la gesti贸n de clientes.
*   **web_map:** Para la visualizaci贸n de activos en un mapa.

#### Flujos de Negocio Cubiertos
*   Gesti贸n de la topolog铆a de red (Zonas, Nodos, Postes, Cajas).
*   Gesti贸n de equipos de fibra 贸ptica (OLTs, Tarjetas, Puertos, Splitters).
*   Gesti贸n de equipos de acceso (APs - Access Points).
*   Gesti贸n de contratos de servicio de internet.
*   Integraci贸n con servidores RADIUS para autenticaci贸n y gesti贸n de servicios (AAA).
*   Asistentes para la configuraci贸n de equipos de red (Routers, NAS RADIUS).

#### L铆mites Claros (lo que entra y lo que no)
*   **Entra:** Gesti贸n de la infraestructura f铆sica y l贸gica, gesti贸n de servicios RADIUS y contratos b谩sicos.
*   **No Entra (presumiblemente):** Facturaci贸n detallada y contabilidad avanzada (se apoya en Odoo est谩ndar), portal de cliente autogestionado (requerir铆a desarrollo adicional), monitoreo de red en tiempo real (el m贸dulo gestiona la configuraci贸n, no el estado en vivo).

### Cronograma y Roadmap
`[COMPLETAR: Definir las fases del proyecto, desde la implementaci贸n inicial hasta futuras mejoras. Ejemplo: Fase 1: Inventario de Red. Fase 2: Gesti贸n de Contratos. Fase 3: Automatizaci贸n RADIUS.]`

### Roles y Responsables
Basado en el archivo `security/ir.model.access.csv`, se identifican los siguientes roles:
*   **Usuario de ISP:** Acceso de lectura a la mayor铆a de los modelos de red.
*   **Manager de ISP:** Acceso completo (crear, leer, escribir, borrar) a todos los modelos del m贸dulo.

**Equipo del Cliente:**
`[COMPLETAR: Nombre del Gerente de Proyecto, Usuarios Clave de Red, Responsable de Contratos, etc.]`

**Equipo Implementador:**
`[COMPLETAR: Nombre del Project Manager, Consultor Funcional, Desarrollador Principal.]`

### Riesgos y Mitigaciones
*   **Riesgo:** Resistencia al cambio por parte del personal t茅cnico acostumbrado a otros sistemas.
    *   **Mitigaci贸n:** Involucrar a los usuarios clave desde el inicio, realizar capacitaciones pr谩cticas y demostrar los beneficios en la operaci贸n diaria.
*   **Riesgo:** Incompatibilidad con ciertos modelos de hardware de red.
    *   **Mitigaci贸n:** Realizar pruebas de concepto (PoC) con el hardware principal (OLTs, routers) antes del despliegue completo.
*   **Riesgo:** Problemas en la migraci贸n de datos desde sistemas antiguos.
    *   **Mitigaci贸n:** Planificar una estrategia de ETL (Extracci贸n, Transformaci贸n y Carga) detallada, validando los datos importados (el script `importar.py` es un indicio de este proceso).

### KPIs del Proyecto
`[COMPLETAR: Definir m茅tricas medibles. Ejemplos:]`
*   Reducci贸n del tiempo de activaci贸n de un cliente en un 50%.
*   Disminuci贸n de errores de inventario en un 90%.
*   Tasa de resoluci贸n de problemas en primera llamada mejorada en un 30%.

### Presupuesto y Costos
`[COMPLETAR: Detallar costos de licencias Odoo Enterprise (si aplica), horas de desarrollo para customizaciones, infraestructura de servidores y mantenimiento.]`

---
##  Documentaci贸n T茅cnica

### Arquitectura del Sistema
*   **Servidor Odoo:** Aplicaci贸n principal que corre el m贸dulo `silver_isp`.
*   **Base de Datos:** PostgreSQL, como es est谩ndar en Odoo.
*   **Proxy Inverso:** (Recomendado) Nginx para gestionar las conexiones web y terminar SSL.
*   **Entorno de Desarrollo:** El proyecto utiliza un entorno virtual de Python (`.venv`), lo que indica una gesti贸n de dependencias aislada.

### Versionado y Dependencias
*   **Versi贸n de Odoo:** `[COMPLETAR: Especificar la versi贸n de Odoo, ej: 16.0, 17.0. Esta informaci贸n deber铆a estar en el manifest.]`
*   **M贸dulos Dependientes (del `__manifest__.py`):** `base`, `mail`, `product`, `contacts`, `account`, `web_map`. La dependencia de `web_map` confirma la necesidad de vistas geogr谩ficas.
*   **Repositorio Git:** `[COMPLETAR: URL del repositorio Git y estrategia de ramas (ej: main, develop, feature-branches).]`

### Estructura de M贸dulos Desarrollados (Ampliado)

El m贸dulo `silver_isp` est谩 organizado en componentes l贸gicos que representan las diferentes capas de la operaci贸n de un ISP.

#### 1. Modelos de Infraestructura F铆sica (`models/`)
Representan la jerarqu铆a de la red f铆sica pasiva.
*   `isp_zone.py`: Define zonas geogr谩ficas para agrupar la infraestructura. Es el nivel m谩s alto de la jerarqu铆a.
*   `isp_node.py`: Representa un nodo o punto de presencia dentro de una zona. Puede ser una central, un armario de calle, etc.
*   `isp_post.py`: Modela los postes f铆sicos donde se montan los equipos. Se relaciona con un nodo.
*   `isp_box.py`: Define las cajas de empalme o CTOs que se instalan en los postes.
*   `isp_asset.py`: Un modelo base (mixin) para dar capacidades de "activo" a otros modelos, como seguimiento de n煤mero de serie, ubicaci贸n, etc.

#### 2. Modelos de Equipamiento Activo (`models/`)
Representan los dispositivos electr贸nicos de la red.
*   `isp_olt.py`: Modela las **Terminales de L铆nea ptica (OLT)**, el equipo central de una red PON.
*   `isp_olt_card.py`: Modela las tarjetas o placas que se insertan en un chasis de OLT.
*   `isp_olt_card_port.py`: Modela los puertos f铆sicos en cada tarjeta de la OLT, que es donde finalmente se conecta el cliente.
*   `isp_ap.py`: Gestiona los **Puntos de Acceso (Access Points)** para servicios inal谩mbricos.
*   `isp_router.py`: Almacena la configuraci贸n de routers, probablemente para automatizar tareas.
*   `isp_netdev.py`: Un modelo m谩s gen茅rico para otros dispositivos de red.

#### 3. Modelos de Componentes Pasivos de Red (`models/`)
Representan los elementos que transportan la se帽al pero no son activos.
*   `isp_cable.py`: Define los cables (troncales, de distribuci贸n) que interconectan los nodos y cajas.
*   `isp_core.py`: Modela los hilos de fibra individuales dentro de un cable.
*   `isp_splitter.py`: Gestiona los divisores 贸pticos (splitters) que se alojan dentro de las `isp.box` para dividir la se帽al de un hilo de fibra a m煤ltiples clientes.
*   `isp_splice_closure.py`: Representa los empalmes de fibra.

#### 4. Modelos de Gesti贸n de Clientes y Servicios (`models/`)
Son el puente entre la infraestructura y el cliente final.
*   `isp_contract.py`: El modelo central que representa el servicio contratado por un cliente. Vincula a un cliente (res.partner) con la infraestructura t茅cnica (un puerto de OLT, un splitter, etc.).
*   `isp_radius.py`, `isp_radius_user.py`: Modelos para la integraci贸n con servidores **RADIUS**. `isp_radius` define los servidores NAS, mientras que `isp_radius_user` representa la cuenta del usuario que se usar谩 para la autenticaci贸n (ej: PPPoE).
*   `isp_radius_pyrad.py`: Contiene la l贸gica de conexi贸n con el servidor RADIUS, probablemente usando la librer铆a `pyrad`.

#### 5. Asistentes y Controladores (`models/*wizards.py`, `controllers/`)
*   **Wizards:** Gu铆an a los usuarios a trav茅s de procesos complejos, como `isp_netdev_radius_client_wizard.py` para a帽adir un cliente RADIUS o `isp_radius_disconnect_wizard.py` para forzar una desconexi贸n.
*   **Controllers (`node_network.py`):** Expone un endpoint web en `/network/nodes`. Este endpoint devuelve una estructura de datos en formato JSON con la jerarqu铆a de la red (nodos, postes, cajas). Su prop贸sito es, probablemente, alimentar una visualizaci贸n de red personalizada en una p谩gina web o una aplicaci贸n externa.

### Estructura de la Base de Datos (Diagrama ERD)

A continuaci贸n se presenta un diagrama Entidad-Relaci贸n (ERD) en formato de texto (Mermaid). Este c贸digo puede ser pegado en un editor compatible con Mermaid (como el de GitLab, GitHub, o editores online) para generar un diagrama visual de las relaciones clave en la base de datos.

```mermaid
erDiagram
    %% Jerarqu铆a F铆sica
    isp_zone ||--o{ isp_node : "Contiene Nodos"
    isp_node ||--o{ isp_post : "Contiene Postes"
    isp_post ||--o{ isp_box : "Contiene Cajas"
    isp_box ||--o{ isp_splitter : "Contiene Splitters"

    %% Jerarqu铆a de Equipos Activos
    isp_olt ||--o{ isp_olt_card : "Tiene Tarjetas"
    isp_olt_card ||--o{ isp_olt_card_port : "Tiene Puertos"

    %% Relaci贸n Cliente-Red
    isp_olt_card_port }|--|| isp_contract : "Conectado a"
    isp_splitter }o--|| isp_contract : "Derivado a"
    "res_partner (Cliente)" ||--|{ isp_contract : "Tiene Contratos"
    isp_contract ||--|| isp_radius_user : "Genera Usuario"

    %% Definici贸n de Entidades Clave
    isp_olt {
        int id
        string name
        string ip_address
        string model
    }
    isp_olt_card_port {
        int id
        string name
        int card_id FK
    }
    isp_contract {
        int id
        string name
        int partner_id FK
        int olt_port_id FK
        int splitter_id FK
    }
    isp_box {
        int id
        string code
        int post_id FK
    }
    isp_radius_user {
        int id
        string username
        string password
        int contract_id FK
    }
```

**Explicaci贸n del Diagrama:**
*   La estructura f铆sica es una clara jerarqu铆a: Una `Zona` tiene muchos `Nodos`, un `Nodo` tiene muchos `Postes`, un `Poste` tiene `Cajas`, y una `Caja` tiene `Splitters`.
*   La estructura de la OLT tambi茅n es jer谩rquica: Una `OLT` tiene `Tarjetas`, y cada `Tarjeta` tiene `Puertos`.
*   El `Contrato` es el modelo central que une todo: Se asocia a un `Cliente` (`res.partner`), se conecta a un `Puerto` de una OLT y/o a un `Splitter`, y genera un `Usuario RADIUS` para la autenticaci贸n.

### Integraciones Externas
*   **Servidores RADIUS:** El m贸dulo est谩 dise帽ado para interactuar con servidores RADIUS para la autenticaci贸n, autorizaci贸n y contabilidad (AAA) de los usuarios. Los modelos `isp_radius.py` y `isp_radius_pyrad.py` sugieren el uso de la librer铆a `pyrad` para esta comunicaci贸n.
*   **Routers y Equipos de Red (OLTs):** El m贸dulo permite almacenar la configuraci贸n de conexi贸n a estos dispositivos, lo que sugiere que podr铆a haber (o est谩 planeado) scripts de automatizaci贸n para aplicar configuraciones v铆a SSH o API.

---
##  Documentaci贸n de Futuro / Backlog

### Funcionalidades Pendientes
`[COMPLETAR: Listar funcionalidades que se acord贸 implementar en fases futuras.]`
*   Portal de cliente para consulta de consumo y pago de facturas.
*   M贸dulo de ticketing para soporte t茅cnico integrado con los modelos de red.
*   Monitoreo proactivo de estado de OLTs y APs.

### Mejoras Sugeridas
*   Implementar una suite de pruebas unitarias (`pytest`) para aumentar la robustez del c贸digo.
*   Desarrollar un dashboard gr谩fico en Odoo con los principales KPIs de la red (clientes activos, puertos libres, etc.).
*   Refactorizar los asistentes (wizards) para mejorar la experiencia de usuario.

### Deuda T茅cnica
*   **Ausencia de Pruebas Automatizadas:** Es el punto m谩s cr铆tico. La falta de tests dificulta la refactorizaci贸n y la detecci贸n de regresiones. Se debe planificar un sprint para a帽adir cobertura de pruebas a los modelos m谩s importantes.
*   **Scripts de Sincronizaci贸n (`ssync.sh`):** Aunque funcionales, estos scripts pueden ser fr谩giles. Evaluar el uso de herramientas de despliegue m谩s robustas como Ansible o Docker Compose para la gesti贸n de entornos.

