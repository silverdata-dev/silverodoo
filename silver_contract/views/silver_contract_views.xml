<odoo>
    <data>
        <!-- silver.contract list view -->
        <record id="silver_contract_view_tree" model="ir.ui.view">
            <field name="name">silver.contract.view.list</field>
            <field name="model">silver.contract</field>
            <field name="arch" type="xml">
                <list>
                    <field name="name" widget="record_link"/>
                    <field name="partner_id"  widget="many2one" context="{'ciname':1}"/>
                    <field name="date_start"/>
                    <field name="date_end"/>

                    <field name="state"
                           widget="badge"
                           decoration-success="state in ['active']"
                           decoration-warning="state in ('draft')"
                           decoration-danger="state in ['closed']"/>

                    <field name="state_service"
                           widget="badge"
                           decoration-success="state_service in ['active', 'open']"
                           decoration-warning="state_service in ('suspended', 'inactive')"
                           decoration-danger="state_service in ['terminated', 'disabled']"/>
                </list>
            </field>
        </record>



        <!-- silver.contract form view -->
        <record id="silver_contract_view_form" model="ir.ui.view">
            <field name="name">silver.contract.view.form</field>
            <field name="model">silver.contract</field>
            <field name="arch" type="xml">
                <form string="Contrato">
                    <header>
                    <button name="init_contract" type="object" class="oe_highlight"  string="Iniciar Contrato" invisible="state in ['open', 'active']"/>
                    <button name="close_contract" type="object" class="oe_highlight"  string="Cerrar Contrato" invisible="(state!='active') or (state_service=='active')"/>
                    <button name="start_contract" type="object" class="oe_highlight"  string="Activar Contrato" invisible="(state!='open') or (state_service!='active')"/>


                    </header>
                    <sheet>
                        <div class="oe_avatar">
                            <field name="image" widget="image" class="oe_avatar"/>
                        </div>
                        <div class="oe_title d-flex align-items-center">
                            <h1 class="d-inline-block mb-0">
                                <field name="name" readonly="1"/>
                            </h1>
                            <div>
                                <div class="contract-status-pill status-disabled" invisible="state!='draft'">
                                    <field name="state" readonly="1"/>
                                </div>
                                <div class="contract-status-pill status-removed" invisible="state!='closed'">
                                    <field name="state" readonly="1"/>
                                </div>

                                <div class="contract-status-pill status-active" invisible="state!='active' or state_service != 'active'">
                                    <field name="state_service" readonly="1"/>
                                </div>
                                <div class="contract-status-pill status-open" invisible="((state not in ['open']) or state_service not in ['active'])">
                                    Abierto
                                </div>
                                <div class="contract-status-pill status-suspended" invisible="state not in ['open', 'active'] or state_service != 'suspended'">
                                    <span invisible="state!='active'">(Activo) </span>
                                    <field name="state_service" readonly="1"/>
                                </div>
                                <div class="contract-status-pill status-disabled" invisible="state not in ['open', 'active'] or state_service != 'disabled'">
                                    <span invisible="state!='active'">(Activo) </span>
                                    <field name="state_service" readonly="1"/>
                                </div>
                                <div class="contract-status-pill status-removed" invisible="state not in ['open', 'active'] or state_service != 'removed'">
                                    <span invisible="state!='active'">(Activo) </span>
                                    <field name="state_service" readonly="1"/>
                                </div>
                                <div class="contract-status-pill status-default" invisible="state not in ['open', 'active'] or state_service in ('open', 'active', 'suspended', 'disabled', 'removed')">
                                    <span invisible="state!='active'">(Activo) </span>
                                    <field name="state_service" readonly="1"/>
                                </div>
                            </div>
                        </div>

                        <group>
                            <group>
                                <field name="state" invisible="1"/>
                                <field name="payment_type_code" invisible="1"/>
                                <field name="is_first_invoice" invisible="1"/>
                                <field name="is_extra_value_active" invisible="1"/>
                                <field name="is_extra_value" invisible="1"/>
                                <field name="state_service" invisible="1"/>
                                <field name="partner_id" readonly="state != 'draft'"  widget="many2one_avatar_user"/>
                                <field name="silver_address_id" context="{'show_address': 1}" options='{"always_reload": True, "no_quick_create": False}'/>
                                <field name="phone"/>
                            </group>
                            <group>
                                   <field name="service_type_id"
                                          options="{'no_create_edit': True, 'no_quick_create': True}" readonly="state != 'draft'"/>
                            <field name="plan_type_id"
                                   options="{'no_create_edit': True, 'no_quick_create': True}"
                                   readonly="state != 'draft'" domain="[('service_type_id', '=', service_type_id)]"  required="1"/>
                            <field name="cutoff_date_id"
                                   options="{'no_create_edit': True, 'no_quick_create': True}"
                                   readonly="state != 'draft'" domain="[('plan_type_id', '=', plan_type_id)]"  required="1"/>
                            <field name="contract_term_id" readonly="state != 'draft'" required="1"/>
                                <!--field name="service_plan_id"/-->
                            </group>

                        </group>

                        <notebook>
                            <page string="Servicios" name="invoice_info">

                                <field name="line_ids" readonly="state != 'draft'"
                                       context="{'default_line_type': 'recurring'}">
                                    <list editable="bottom">

                                        <field name="name"/>
                                        <field name="quantity"/>
                                        <field name="price_unit"/>
                                        <field name="price_subtotal" sum="Total"/>
                                        <field name="line_type" invisible="1"/>
                                    </list>
                                </field>
                                <!--separator string="Valores Extra (Cargos Únicos)"/>
                                <field name="line_debit_ids" readonly="state != 'draft'"
                                       context="{'default_line_type': 'one_time'}">
                                    <list editable="bottom">
                                        <field name="product_id"/>
                                        <field name="name"/>
                                        <field name="quantity"/>
                                        <field name="price_unit"/>
                                        <field name="price_subtotal" sum="Total"/>
                                        <field name="line_type" invisible="1"/>
                                    </list>
                                </field-->
                                <group name="invoice_fields">
                                <group name="invoice_fields2">
                                    <field name="is_recurring_invoicing_type" invisible="1" modifiers="{&quot;invisible&quot;: true}"/>
                                    <field name="recurring_invoicing_type" readonly="state != 'draft'"  string="Tipo de Consumo" on_change="1" modifiers="{&quot;readonly&quot;: true}"/>
                                    <field name="payment_type_id" options="{'no_create': True}" widget="selection" required="1" readonly="state != 'draft'" on_change="1" can_create="true" can_write="true" modifiers="{&quot;readonly&quot;: [[&quot;state&quot;, &quot;!=&quot;, &quot;draft&quot;]], &quot;required&quot;: true}"/>
                                    <field name="is_other_partner_bank" invisible="payment_type_code not in ['credit_card','debit']" readonly="state != 'draft'" widget="boolean_toggle" on_change="1" modifiers="{&quot;invisible&quot;: [[&quot;payment_type_code&quot;, &quot;not in&quot;, [&quot;credit_card&quot;, &quot;debit&quot;]]], &quot;readonly&quot;: [[&quot;state&quot;, &quot;!=&quot;, &quot;draft&quot;]]}"/>
                                    <field name="partner_bank_id" invisible="is_other_partner_bank == False" required="is_other_partner_bank == True" readonly="state != 'draft'" options="{'no_create': True}" can_create="true" can_write="true" modifiers="{&quot;invisible&quot;: [[&quot;is_other_partner_bank&quot;, &quot;=&quot;, false]], &quot;readonly&quot;: [[&quot;state&quot;, &quot;!=&quot;, &quot;draft&quot;]], &quot;required&quot;: [[&quot;is_other_partner_bank&quot;, &quot;=&quot;, true]]}"/>
                                    <field name="res_partner_bank_id" invisible="payment_type_code not in ['credit_card','debit']" required="payment_type_code in ['credit_card','debit']" readonly="state != 'draft'" domain="['|',('partner_id','=',partner_id),('partner_id','=',partner_bank_id)]" widget="selection" can_create="true" can_write="true" modifiers="{&quot;invisible&quot;: [[&quot;payment_type_code&quot;, &quot;not in&quot;, [&quot;credit_card&quot;, &quot;debit&quot;]]], &quot;readonly&quot;: [[&quot;state&quot;, &quot;!=&quot;, &quot;draft&quot;]], &quot;required&quot;: [[&quot;payment_type_code&quot;, &quot;in&quot;, [&quot;credit_card&quot;, &quot;debit&quot;]]]}"/>
                                    <button name="action_generate_first_invoice" string="&#8658;Generar Primer AC" type="object" class="oe_highlight" invisible="is_first_invoice == True or (is_extra_value_active == True and is_extra_value == False)" readonly="state != 'draft'" modifiers="{&quot;invisible&quot;: [&quot;|&quot;, [&quot;is_first_invoice&quot;, &quot;=&quot;, true], &quot;&amp;&quot;, [&quot;is_extra_value_active&quot;, &quot;=&quot;, true], [&quot;is_extra_value&quot;, &quot;=&quot;, false]], &quot;readonly&quot;: [[&quot;state&quot;, &quot;!=&quot;, &quot;draft&quot;]]}"/>
                                    <button name="action_generate_first_ext_materials" string="&#8658;Generar AC Extras" type="object" class="oe_link" invisible="is_extra_value == True or is_extra_value_active == False" readonly="state != 'draft'" modifiers="{&quot;invisible&quot;: [&quot;|&quot;, [&quot;is_extra_value&quot;, &quot;=&quot;, true], [&quot;is_extra_value_active&quot;, &quot;=&quot;, false]], &quot;readonly&quot;: [[&quot;state&quot;, &quot;!=&quot;, &quot;draft&quot;]]}"/>
                                </group>
                                <group name="invoice_fields1">
                                    <field name="is_select_journal_invoice" invisible="1" modifiers="{&quot;invisible&quot;: true, &quot;readonly&quot;: true}"/>
                                    <field name="type_journal_invoice" widget="selection" invisible="is_select_journal_invoice == False" on_change="1" modifiers="{&quot;invisible&quot;: [[&quot;is_select_journal_invoice&quot;, &quot;=&quot;, false]]}"/>
                                    <!--field name="journal_id" widget="selection" readonly="1" invisible="is_select_journal_invoice == False" can_create="true" can_write="true" modifiers="{&quot;invisible&quot;: [[&quot;is_select_journal_invoice&quot;, &quot;=&quot;, false]], &quot;readonly&quot;: true}"/-->
                                    <label for="recurring_invoices" string="Recurrencia"/>
                                    <div class="o_row">
                                        <field name="recurring_invoices" widget="boolean_toggle" on_change="1" modifiers="{}"/>
                                        <field name="recurring_interval" class="oe_inline" nolabel="1" modifiers="{&quot;readonly&quot;: [[&quot;state&quot;, &quot;not in&quot;, [&quot;draft&quot;, &quot;pending&quot;]]]}"/>
                                        <field name="recurring_rule_type" class="oe_inline" nolabel="1" on_change="1" modifiers="{&quot;readonly&quot;: [[&quot;state&quot;, &quot;not in&quot;, [&quot;draft&quot;, &quot;pending&quot;]]]}"/>
                                    </div>
                                    <field name="recurring_next_date" readonly="1" force_save="1" string="Fecha Pr&#243;ximo AC" modifiers="{&quot;readonly&quot;: true}"/>
                                </group>
                            </group>
                                 <group string="Descuentos y promociones">
                                <group name="discount_main">



                <field name="contract_discount_id" widget="selection" readonly="promotion_active == True" can_create="true" can_write="true" modifiers="{&quot;readonly&quot;: [[&quot;promotion_active&quot;, &quot;=&quot;, true]]}"/>
                <field name="active_payment_anticipated" widget="boolean_toggle" modifiers="{}"/>
                <field name="contract_discount_ids" invisible="True" can_create="true" can_write="true" modifiers="{&quot;invisible&quot;: true, &quot;readonly&quot;: true}"/>
                <button string="=&gt; Asignar Promoci&#243;n " name="action_assing_discount" type="object" class="oe_link" invisible="promotion_active == True or state == 'draft'" modifiers="{&quot;invisible&quot;: [[&quot;promotion_active&quot;, &quot;=&quot;, true], [&quot;state&quot;, &quot;=&quot;, &quot;draft&quot;]]}"/>
                <button name="action_assing_discount_manual" string="Asignar Descuento Manual" invisible="promotion_active == False or state == 'draft'" icon="fa-plus-circle" type="object" class="oe_link" modifiers="{&quot;invisible&quot;: [&quot;|&quot;, [&quot;promotion_active&quot;, &quot;=&quot;, false], [&quot;state&quot;, &quot;=&quot;, &quot;draft&quot;]]}"/>
                <field name="promotion_active" invisible="1" modifiers="{&quot;invisible&quot;: true, &quot;readonly&quot;: true}"/>
                <field name="contract_discount_line_id" readonly="1" invisible="promotion_active != True" can_create="true" can_write="true" modifiers="{&quot;invisible&quot;: [[&quot;promotion_active&quot;, &quot;!=&quot;, true]], &quot;readonly&quot;: true}"/>
            </group>
   <group name="discount_main_1">
                                    <field name="is_disabled" widget="boolean_toggle" on_change="1" modifiers="{}"/>
                                    <field name="disability_percentage" invisible="is_disabled == False" on_change="1" modifiers="{&quot;invisible&quot;: [[&quot;is_disabled&quot;, &quot;=&quot;, false]]}"/>
                                    <field name="is_senior" widget="boolean_toggle" on_change="1" modifiers="{}"/>
                                </group>
                            </group>

                            <field name="discount_line_ids" modifiers="{}">
                                <list editable="bottom">

                                    <field name="description"/>
                                    <field name="amount"/>
                                    <field name="apply_date"/>
                                </list>
                                </field>
                <field name="has_promotion_foreign_currency" invisible="1" modifiers="{&quot;invisible&quot;: true, &quot;readonly&quot;: true}"/>



                            </page>

                            <page name="other_info" string="Otra Información">


                                        <group>
                                            <group string="Marketing">
                                                <field name="reception_channel_id"/>
                                                <field name="origin"/>
                                                <field name="user_id"/>
                                            </group>
                                            <group string="Firma">
                                                <field name="signature" widget="signature"/>
                                            </group>
                                            <group string="Cargar Documentación">
                                        <field name="doc_vat_copy" widget="binary"
                                               filename="'doc_vat_copy_filename'"/>
                                        <field name="installation_request" widget="binary"
                                               filename="'installation_request_filename'"/>
                                        <field name="service_contract" widget="binary"
                                               filename="'service_contract_filename'"/>
                                        <field name="basic_service_sheet" widget="binary"
                                               filename="'basic_service_sheet_filename'"/>

                                        <field name="is_validated"/>
                                    </group>
                                             <group string="Términos y Condiciones">
                                            <field name="description_contract" nolabel="1"/>
                                        </group>
                                        </group>


                                    <group name="related_records" string="Registros Relacionados">
                                        <field name="referred_line_ids" mode="list">
                                            <list editable="bottom">
                                                <field name="name"/>
                                                <field name="phone"/>
                                                <field name="referred_date"/>
                                                <field name="state"/>
                                                <field name="converted_contract_id"/>
                                            </list>
                                        </field>
                                    </group>

                            </page>
                            <!--page name="notify" string="Notificaciones">
                                <div class="oe_button_box" name="button_box">
                                    <button name="action_register_notification" type="object" class="oe_stat_button"
                                            icon="fa-bell" string="N. Bienvenida"
                                            invisible="state_service != 'active'"/>
                                    <button name="action_amountdue_notification" type="object" class="oe_stat_button"
                                            icon="fa-bell" string="N. Deudas" invisible="state != 'open'"/>
                                    <button name="action_cutoff_notification" type="object" class="oe_stat_button"
                                            icon="fa-bell" string="N. Cortado"
                                            invisible="state_service != 'disabled'"/>
                                    <button name="enable_portal_access_contract" type="object" class="oe_stat_button"
                                            icon="fa-user-plus" string="Permitir Acceso Portal"
                                            invisible="is_portal_user == True"/>
                                    <button name="disable_portal_access_contract" type="object" class="oe_stat_button"
                                            icon="fa-lock" string="Quitar Acceso Portal"
                                            invisible="is_portal_user == False"/>
                                </div>
                                <group>
                                    <group>
                                        <field name="links_payment" readonly="1"/>
                                        <field name="dont_send_notification_wp"/>
                                        <field name="is_portal_user" invisible="1"/>
                                    </group>
                                </group>
                            </page-->
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Acción de Ventana -->
        <record id="silver_contract_action" model="ir.actions.act_window">
            <field name="name">Contratos</field>
            <field name="res_model">silver.contract</field>
            <field name="view_mode">list,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Crea un nuevo contrato de servicio.
                </p>
            </field>
        </record>


        <record id="silver_contract_search_panel" model="ir.ui.view">
            <field name="name">silver.contract.search.panel</field>
            <field name="model">silver.contract</field>
            <field name="arch" type="xml">
                <search>
                    <searchpanel>
                        <field name="state" enable_counters="1" icon="fa fa-filter"/>
                    </searchpanel>
                </search>
            </field>
        </record>

        <!-- Sequence for silver.contract -->
        <record id="sequence_silver_contract" model="ir.sequence">
            <field name="name">Contract Sequence</field>
            <field name="code">silver.contract.sequence</field>
            <field name="prefix">CT-</field>
            <field name="padding">5</field>
            <field name="company_id" eval="False"/>
        </record>
    </data>
</odoo>
