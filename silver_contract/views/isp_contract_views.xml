<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="isp_contract_view_form" model="ir.ui.view">
            <field name="name">isp.contract.form</field>
            <field name="model">isp.contract</field>
            <field name="arch" type="xml">
                <form string="Contrato">
                    <header>
                        <button name="action_activate_service" string="Activar Servicio" type="object" class="oe_highlight" invisible="(state != 'open') or (state_service != 'inactive')"/>
                        <button name="action_cutoff_service" string="Cortar Servicio" type="object" class="oe_highlight" invisible="state_service != 'active'"/>
                        <button name="action_open" string="Confirmar Contrato" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                        <button name="action_cancel" string="Anular" type="object" invisible="state != 'draft'"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,open,done"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <!-- Stat buttons se añadirán aquí en futuras iteraciones -->
                        </div>
                        <div class="oe_title">
                            <h1><field name="name" readonly="1"/></h1>
                        </div>
                        <group>
                            <group>
                                <field name="partner_id" readonly="state != 'draft'"/>
                                <field name="holding_id" readonly="state != 'draft'"/>
                                <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" readonly="state != 'draft'"/>
                            </group>
                            <group>
                                <field name="state_service" widget="badge" decoration-danger="state_service in ('disabled','removed')" decoration-warning="state_service == 'removal_list'" decoration-success="state_service == 'active'" decoration-info="state_service in ('suspended', 'inactive')"/>
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="service_type_id" readonly="state != 'draft'"/>
                                <field name="plan_type_id" readonly="state != 'draft'"/>
                                <field name="tag_ids" widget="many2many_tags" readonly="state != 'draft'"/>
                            </group>
                            <group>
                                <field name="cutoff_day_id" readonly="state != 'draft'"/>
                                <field name="contract_term_id" readonly="state != 'draft'"/>
                            </group>
                        </group>
                        <notebook>
                                                        <page string="Servicios Recurrentes" name="invoice_info">
                                <separator string="Líneas de Servicio Recurrente"/>
                                <field name="line_ids" readonly="state != 'draft'" context="{'default_line_type': 'recurring'}">
                                    <tree editable="bottom">
                                        <field name="product_id"/>
                                        <field name="name"/>
                                        <field name="quantity"/>
                                        <field name="price_unit"/>
                                        <field name="price_subtotal"/>
                                        <field name="line_type" invisible="1"/>
                                    </tree>
                                </field>
                                <separator string="Valores Extra (Cargos Únicos)"/>
                                <field name="line_debit_ids" readonly="state != 'draft'" context="{'default_line_type': 'one_time'}">
                                    <tree editable="bottom">
                                        <field name="product_id"/>
                                        <field name="name"/>
                                        <field name="quantity"/>
                                        <field name="price_unit"/>
                                        <field name="price_subtotal"/>
                                        <field name="line_type" invisible="1"/>
                                    </tree>
                                </field>
                                <group name="invoice_fields">
                                    <group>
                                        <field name="payment_type_id" readonly="state != 'draft'"/>
                                    </group>
                                    <group>
                                        <field name="date_start"/>
                                        <field name="date_end"/>
                                    </group>
                                </group>
                            </page>
                                                        <page name="anticipated_payment" string="Pago Anticipado">
                                <field name="anticipated_payment_line_ids" readonly="state != 'draft'">
                                    <tree editable="bottom">
                                        <field name="date"/>
                                        <field name="description"/>
                                        <field name="amount"/>
                                        <field name="payment_id"/>
                                    </tree>
                                </field>
                            </page>
                            <!--page name="payment_promises" string="Promesas de Pago">
                                <field name="payment_promise_ids" readonly="state != 'draft'">
                                    <tree editable="bottom">
                                        <field name="name"/>
                                        <field name="promise_date"/>
                                        <field name="amount"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </page-->
                            <page name="location" string="Ubicación">
                                <group>
                                    <group>
                                        <field name="street"/>
                                        <field name="street2"/>
                                        <field name="city"/>
                                        <field name="state_id"/>
                                        <field name="country_id"/>
                                        <field name="zip"/>
                                    </group>
                                    <group>
                                        <label for="contract_latitude" string="Coordenadas"/>
                                        <div class="o_row">
                                            <field name="contract_latitude" nolabel="1"/>
                                            <field name="contract_longitude" nolabel="1"/>
                                        </div>
                                    </group>
                                </group>
                            </page>
                            <page name="isp_service" string="Servicio Internet">
                                <notebook>
                                    <page string="Datos Técnicos" name="isp_technical_data">
                                        <div class="oe_button_box" name="button_box">
                                            <button name="action_reconnection_service_button" type="object" class="oe_stat_button" icon="fa-rss" string="Reconectar" invisible="state != 'open'"/>
                                            <button name="action_ping_service" type="object" class="oe_stat_button" icon="fa-feed" string="PING"/>
                                            <button name="action_status_olt" type="object" class="oe_stat_button" icon="fa-signal" string="Status OLT"/>
                                            <button name="action_test_speed_service" type="object" class="oe_stat_button" icon="fa-rocket" string="Test Velocidad"/>
                                            <button name="action_remove_service" type="object" class="oe_stat_button" icon="fa-times-circle" string="Eliminar Servicio"/>
                                            <button name="action_contract_reboot_onu" type="object" class="oe_stat_button" icon="fa-refresh" string="Reiniciar ONU"/>
                                            <button name="action_change_ont_service" type="object" class="oe_stat_button" icon="fa-exchange" string="Cambiar ONU"/>
                                        </div>
                                        <group name="ips_networks_1">
                                            <group>
                                                <field name="link_type" readonly="state != 'draft'"/>
                                            </group>
                                            <group>
                                                <field name="pppoe_user"/>
                                                <field name="pppoe_password" password="True"/>
                                            </group>
                                        </group>
                                        <group name="ips_networks_2" string="Datos Red Externa Asignada">
                                            <group invisible="link_type == 'lan'">
                                                <field name="node_id" readonly="state != 'draft'"/>
                                                <field name="box_id" readonly="state != 'draft'" invisible="link_type not in ['fiber', 'fttb']"/>
                                                <field name="port_nap" readonly="state != 'draft'" invisible="link_type not in ['fiber', 'fttb']"/>
                                                <field name="ap_id" readonly="state != 'draft'" invisible="link_type != 'wifi'"/>
                                            </group>
                                            <group>
                                                <field name="core_id" readonly="state != 'draft'"/>
                                                <field name="olt_id" readonly="state != 'draft'" invisible="link_type not in ['fiber', 'fttb']"/>
                                                <field name="olt_port_id" readonly="state != 'draft'" invisible="link_type not in ['fiber', 'fttb']"/>
                                                <field name="splitter_id" readonly="state != 'draft'" invisible="link_type not in ['fiber', 'fttb']"/>
                                            </group>
                                        </group>
                                        <group name="ips_networks_3">
                                            <group string="Datos Equipos Asignados">
                                                <field name="serial_onu" readonly="state != 'draft'"/>
                                                <field name="model_onu" readonly="state != 'draft'"/>
                                                <field name="is_bridge" readonly="state != 'draft'"/>
                                            </group>
                                            <group string="Datos Lógicos Asignados">
                                                <field name="ip_address"/>
                                                <field name="mac_address_onu"/>
                                            </group>
                                        </group>
                                    </page>
                                    <page name="other_info_internet" string="Fechas Programadas">
                                        <group>
                                            <group name="ips_networks_start" string="Fechas Inicio">
                                                <field name="date_start"/>
                                                <field name="date_active"/>
                                                <field name="date_reconnection"/>
                                            </group>
                                            <group name="ips_networks_cut" string="Fechas Corte">
                                                <field name="date_cut"/>
                                                <field name="date_renovation"/>
                                                <field name="date_end"/>
                                            </group>
                                        </group>
                                    </page>
                                    <page name="gestion_wifi" string="Gestión Onu/WiFi">
                                        <group>
                                            <group string="Credenciales WiFi">
                                                <field name="sssid"/>
                                                <field name="password"/>
                                                <field name="custom_channel_id" invisible="link_type != 'wifi'"/>
                                            </group>
                                        </group>
                                        <group string="Configuración WAN">
                                            <field name="contract_mode_wan_ids">
                                                <tree editable="bottom">
                                                    <field name="name"/>
                                                    <field name="protocol"/>
                                                    <field name="vlan_id"/>
                                                </tree>
                                            </field>
                                        </group>
                                    </page>
                                    <page name="mb_consumption" string="Consumo Megas">
                                        <field name="consumption_ids" readonly="1">
                                            <tree>
                                                <field name="date"/>
                                                <field name="download_gb"/>
                                                <field name="upload_gb"/>
                                                <field name="total_gb"/>
                                            </tree>
                                        </field>
                                    </page>
                                    <page name="data_radius" string="Informacion Radius">
                                        <field name="radius_entry_ids" readonly="1">
                                            <tree>
                                                <field name="session_start"/>
                                                <field name="session_end"/>
                                                <field name="session_duration"/>
                                                <field name="framed_ip_address"/>
                                                <field name="nas_ip_address"/>
                                            </tree>
                                        </field>
                                    </page>
                                </notebook>
                            </page>
                            <page name="isp_stock" string="Materiales Asignados">
                                <field name="stock_line_ids" readonly="state != 'draft'">
                                    <tree editable="bottom">
                                        <field name="product_id"/>
                                        <field name="lot_id"/>
                                        <field name="quantity"/>
                                        <field name="assignment_date"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </page>
                            <page name="documentation" string="Documentación">
                                <group string="Cargar Documentación">
                                    <group>
                                        <field name="doc_vat_copy" widget="binary" filename="'doc_vat_copy_filename'"/>
                                        <field name="installation_request" widget="binary" filename="'installation_request_filename'"/>
                                        <field name="service_contract" widget="binary" filename="'service_contract_filename'"/>
                                        <field name="basic_service_sheet" widget="binary" filename="'basic_service_sheet_filename'"/>
                                    </group>
                                    <group>
                                        <field name="is_validated"/>
                                    </group>
                                </group>
                            </page>
                            <page name="other_info" string="Otra Información">
                                <notebook>
                                    <page name="general" string="General">
                                        <group>
                                            <group string="Marketing">
                                                <field name="reception_channel_id"/>
                                                <field name="origin"/>
                                                <field name="user_id"/>
                                            </group>
                                            <group string="Firma">
                                                <field name="signature" widget="signature"/>
                                            </group>
                                        </group>
                                        <group string="Términos y Condiciones">
                                            <field name="description_contract" nolabel="1"/>
                                        </group>
                                    </page>
                                    <page name="related_records" string="Registros Relacionados">
                                        <field name="referred_line_ids" mode="tree">
                                            <tree editable="bottom">
                                                <field name="name"/>
                                                <field name="phone"/>
                                                <field name="referred_date"/>
                                                <field name="state"/>
                                                <field name="converted_contract_id"/>
                                            </tree>
                                        </field>
                                    </page>
                                </notebook>
                            </page>
                            <page name="notify" string="Notificaciones">
                                <div class="oe_button_box" name="button_box">
                                    <button name="action_register_notification" type="object" class="oe_stat_button" icon="fa-bell" string="N. Bienvenida" invisible="state_service != 'active'"/>
                                    <button name="action_amountdue_notification" type="object" class="oe_stat_button" icon="fa-bell" string="N. Deudas" invisible="state != 'open'"/>
                                    <button name="action_cutoff_notification" type="object" class="oe_stat_button" icon="fa-bell" string="N. Cortado" invisible="state_service != 'disabled'"/>
                                    <button name="enable_portal_access_contract" type="object" class="oe_stat_button" icon="fa-user-plus" string="Permitir Acceso Portal" invisible="is_portal_user == True"/>
                                    <button name="disable_portal_access_contract" type="object" class="oe_stat_button" icon="fa-lock" string="Quitar Acceso Portal" invisible="is_portal_user == False"/>
                                </div>
                                <group>
                                    <group>
                                        <field name="links_payment" readonly="1"/>
                                        <field name="dont_send_notification_wp"/>
                                        <field name="is_portal_user" invisible="1"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Acción de Ventana -->
        <record id="isp_contract_action1" model="ir.actions.act_window">
            <field name="name">Contratos ISP</field>
            <field name="res_model">isp.contract</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Crea un nuevo contrato de servicio.
                </p>
            </field>
        </record>

    </data>
</odoo>
